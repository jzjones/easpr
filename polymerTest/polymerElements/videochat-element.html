<link rel="import" href="../bower_components/polymer/polymer.html">
<script src="../jquery_webrtc/jq.js"></script>
<script src="../jquery_webrtc/rtc.js"></script>
<link href="../../bootstrap/css/bootstrap.min.css" rel="stylesheet">
<link href="../../css/demo.css" rel="stylesheet">
<script src="../../bootstrap/js/bootstrap.min.js"></script>
<polymer-element name="videochat-element" attributes="name sessionName">
  <template>
  
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    	<div class="container">
        	<div class="navbar-header">
        		
          		<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            		<span class="sr-only">Toggle navigation</span>
            		<span class="icon-bar"></span>
            		<span class="icon-bar"></span>
            		<span class="icon-bar"></span>
          		</button>
          		<a class="navbar-brand" href="#">Easpr Demo</a>
        	</div>
        	<div class="navbar-collapse collapse">
          		<form class="navbar-form navbar-right" role="form">
            		<div class="form-group" id="roomNav">
              			<input type="text" placeholder="Room name" id="roomName" name="roomName" class="form-control">
            		</div>
            		<button type="button" id="createBtn" class="btn btn-success" on-click="{{createRoom}}">Create Room</button>
            		<button type="button" id="joinBtn" class="btn btn-success" on-click="{{joinRoom}}">Join Room</button>
            		<div class="form-group">
              			<span id="roomSpan">RoomName</span>
            		</div>
          		</form>
        	</div><!--/.navbar-collapse -->
      	</div>
    </div>
    
	<div id="videoStream"></div>
  </template>

  <script>
  Polymer('videochat-element',{
	  
	  

  	ready: function(){
  		
  		this.connection = new RTCMultiConnection();
  		this.joined = false;
  		this.connection.session = {
  			audio: true,
  			video: true,
        screen: true
  		}
  		this.connection.onclose = function(e){
			console.log("inside onclose");  			
			console.log(this);  			
  			this.joined = false;	
  		
  		};
  		this.connection.onstream = function(e){
  			
  			console.log("Adding video stream");
  			$('#videoStream').append(e.mediaElement);
  			
  		};
  		this.connection.onstreamended = function(e){
  			if(e.mediaElement.parentNode) e.mediaElement.parentNode.removeChild(e.mediaElement);
  		};
  		console.log("test");
  		console.log(this.connection.channel);
  	},
  		
//   		function(){
//   		this.webrtc=new WebRTC({
	
// 			// the id/element dom element that will hold "our" video
// 			localVideoEl : 'localVideo',
// 			// the id/element dom element that will hold remote videos
// 			remoteVideosEl : 'remotesVideos',
// 			// immediately ask for camera access
// 			autoRequestMedia : true
// 			});
  	
  	createRoom:function(){
		if(this.joined){
			this.joined = false;
			this.connection.leave(); 
  			$('#videoStream').empty();

		}
		this.connection.open($('#roomName').val());
		this.joined = true;
		$('#roomName').val("");
		this.connection.connect(this.connection.channel);
		this.connection.join({
  		    sessionid: this.connection.channel,
  		    userid: 'initiator-id',
  		    session: {audio:true,video:true,screen: true},
  		    extra: {}
  		});
		console.log(this.connection.channel);

  		
  	},

  	joinRoom:function(){
  		if(this.joined){
			this.joined = false;
  			this.connection.leave();
  			$('#videoStream').empty();
		
		}
  		this.connection.connect($('#roomName').val());
  		this.joined = true;

  		this.connection.join({
  		    sessionid: this.connection.channel,
  		    userid: 'initiator-id',
  		    session: {audio:true,video:true,screen: true},
  		    extra: {}
  		});
		console.log(this.connection.channel);

  	}
  });
  </script>
</polymer-element>