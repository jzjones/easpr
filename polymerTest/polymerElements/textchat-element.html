<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel='import' href='./webrtc-element.html'>
<script src="../jquery_webrtc/rtc.js"></script>

<polymer-element name="textchat-element" attributes="name sessionName" extends="webrtc-element" constructor='textChatElement'>
  <template>
    <div id='textDiv'>
      <div id='viewText'></div>
      <div id='writeText'>
          <textarea id='textBox'></textarea>
          <button on-click='{{sendText}}'>Send</button>
      </div>
    </div>
  </template>

  <script>
  Polymer('textchat-element',{
       
    ready: function(){
      this.super();
      var root=this.shadowRoot;
      this.connection.onCustomMessage = function(message){

      var mDiv = document.createElement('div');
      var span=document.createElement('span');
      span.innerHTML=message;
      console.log(span);
      mDiv.appendChild(span);
      console.log(mDiv);
      root.querySelector('#viewText').appendChild(mDiv);

      };
    },
    createMessage: function(){
      var currentMessage=this.shadowRoot.querySelector('#textBox').value;
      this.connection.sendCustomMessage(currentMessage);
      var mDiv = document.createElement('div');
      var span=document.createElement('span');
      span.innerHTML=currentMessage;
      mDiv.appendChild(span);
      this.shadowRoot.querySelector('#textBox').value='';
      return mDiv;
    },
    sendText: function(){
      console.log('inside sendText');
      this.shadowRoot.querySelector('#viewText').appendChild(this.createMessage());
      
    }
  });
  </script>
</polymer-element>
