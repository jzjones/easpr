<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel='import' href='./webrtc-element.html'>

<polymer-element name="textchat-element" attributes="name sessionName" extends="webrtc-element" constructor='TextChatElement'>
  <template>
    <div id='textDiv'>
      <div id='viewText'></div>
      <div id='writeText'>
          <textarea id='textBox'></textarea>
          <button on-click='{{sendText}}'>Send</button>
      </div>
    </div>
  </template>

  <script>
  Polymer('textchat-element',{
       
    ready: function(){
      this.super();
      var root=this.shadowRoot;
      this.connection.onmessage = function(e){

        var mDiv = document.createElement('div');
        var span=document.createElement('span');
        span.innerHTML=e.data;
        mDiv.appendChild(span);
        root.querySelector('#viewText').appendChild(mDiv);
      };
      
    },
    
    initialize: function(channelID){
    	this.super([channelID, {data: true}]);
    	this.connection.sessionid = ("text_" + this.connection.channel);
    },
    
    createMessage: function(){
    	console.log(this.connection);
      var currentMessage=this.shadowRoot.querySelector('#textBox').value;
      this.connection.send(currentMessage);
      var mDiv = document.createElement('div');
      var span=document.createElement('span');
      span.innerHTML=currentMessage;
      mDiv.appendChild(span);
      this.shadowRoot.querySelector('#textBox').value='';
      return mDiv;
    },
    sendText: function(){
      this.shadowRoot.querySelector('#viewText').appendChild(this.createMessage());
      
    }
  });
  </script>
</polymer-element>
