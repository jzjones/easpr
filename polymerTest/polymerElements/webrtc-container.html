<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/platform/platform.js">
<link rel='import' href='./webrtc-element.html'>
<link rel='import' href='videochat-element.html'>
<link rel='import' href='textchat-element.html'>
<link rel='import' href="map-element.html">
<link rel='import' href="../bower_components/polymer-ui-collapsible/polymer-ui-collapsible.html">

<link rel="import" href="../bower_components/polymer-ui-splitter/polymer-ui-splitter.html">
<link rel="stylesheet" href="../bower_components/polymer-flex-layout/polymer-flex-layout.css">
<link rel="stylesheet" href="../bower_components/polymer-ui-base-css/base.css">

<style>
      body {
        -webkit-user-select: none;
        -moz-user-select: none;
        -webkit-tap-highlight-color: rgba(0,0,0,0);
      }
      
      .container {
        width: 1200px;
        height: 600px;
        border: 4px solid #aaa;
      }
      
      .container div {
        overflow: hidden;
      }
      
      #videoDiv {
        width: 500px;
      }
      
      #box1, #box3, #box5, #box6 {
        width: 100px;
      }
      
      #box2, #box4 {
        height: 40px;
      }
      
      polymer-ui-splitter {
		display: block;
		width: 10px;
		background-image: url(http://www.polymer-project.org/components/polymer-ui-splitter/handle.png);
		background-color: rgb(239, 239, 239);
		box-shadow: rgb(204, 204, 204) 0px 0px 2px 1px inset;
		opacity: 0.9;
		cursor: col-resize;
		background-position: 50% 50%;
		background-repeat: no-repeat no-repeat;
		background-color: rgb(221, 221, 221);
	  }

</style>


<polymer-element name="webrtc-container" attributes="name sessionName" extends="webrtc-element" constructor='WebRTCContainer'>
  <template>

    <button on-click="{{addMap}}">Add Map</button>
   
    <div class="container flexbox" style="width:100%">
      <div>
      	<div id="videoDiv" style="height:100%;"></div>
      </div>
      <polymer-ui-splitter direction="left"></polymer-ui-splitter>
      <div style="height:100%" flex>
      	<div id="mapDiv" style="height:100%; width:100%"></div>
      </div>
    </div>

  
    <polymer-ui-collapsible>
      <div class="polymer-ui-collapsible-header">Header</div>
      <div id="textDiv" class="polymer-ui-collapsible"></div>
    </polymer-ui-collapsible>


  </template>

  <script>
  Polymer('webrtc-container',{
       
    ready: function(){
      this.super();
    },
    
    initialize: function(channelID,attempt){
        var session = {audio: false, video: false, screen: false, data: false};
    	this.super([channelID, session]);
    	this.addText(attempt);
    	//this.addMap(attempt);
    	this.addVideo(attempt);
    },
    
    addElements: function(attempt, cbObj){
    	this.addVideo(attempt);
    	cbObj.addText(attempt);
    },
    
    addVideo: function(attempt){
    	var vidEl = new VideoChatElement();
    	vidEl.initialize(this.connection.channel);
    	this.shadowRoot.querySelector('#videoDiv').appendChild(vidEl);
         if(attempt==='create'){
            vidEl.initiate();
        }else{
            vidEl.join();
        }
    },
    
    addText: function(attempt){
    	var textEl = new TextChatElement();
    	textEl.initialize(this.connection.channel);
    	this.shadowRoot.querySelector('#textDiv').appendChild(textEl);
        if(attempt==='create'){
            textEl.initiate();
        }else{
            textEl.join();
        }
    },
    
    addMap: function(attempt){
    	var mapEl = new MapElement();
    	mapEl.initialize(this.connection.channel);
    	this.shadowRoot.querySelector('#mapDiv').appendChild(mapEl);
        if(attempt==='create'){
            mapEl.initiate();
        }else{
            mapEl.join();
        }
    },
    
    removeVideo: function(){
    	var vidEl = this.shadowRoot.querySelector('#videoDiv').querySelector("videochat-element");
    	vidEl.end();
    	this.shadowRoot.querySelector('#videoDiv').removeChild(vidEl);
    },
    
    removeText: function(){
    	var textEl = this.shadowRoot.querySelector('#textDiv').querySelector("textchat-element");
    	textEl.end();
    	this.shadowRoot.querySelector('#textDiv').removeChild(textEl);
    }
  
     
  });
  </script>
</polymer-element>
