<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel='import' href='./webrtc-element.html'>
<link rel='import' href='videochat-element.html'>
<link rel='import' href='textchat-element.html'>
<link rel='import' href="map-element.html">


<polymer-element name="webrtc-container" attributes="name sessionName" extends="webrtc-element" constructor='WebRTCContainer'>
  <template>
  <button on-click="{{addMap}}">Add Map</button>
    <div id='elementDiv'>
        <div id="videoDiv"></div>
        <div id="textDiv"></div>
        <div id="mapDiv"></div>
    </div>
  </template>

  <script>
  Polymer('webrtc-container',{
       
    ready: function(){
      this.super();
    },
    
    initialize: function(channelID,attempt){
        var session = {audio: false, video: false, screen: false, data: false};
    	this.super([channelID, session]);
    	this.addText(attempt);
    	//this.addMap(attempt);
    	this.addVideo(attempt);
    },
    
    addElements: function(attempt, cbObj){
    	this.addVideo(attempt);
    	cbObj.addText(attempt);
    },
    
    addVideo: function(attempt){
    	var vidEl = new VideoChatElement();
    	vidEl.initialize(this.connection.channel);
    	this.shadowRoot.querySelector('#videoDiv').appendChild(vidEl);
         if(attempt==='create'){
            vidEl.initiate();
        }else{
            vidEl.join();
        }
    },
    
    addText: function(attempt){
    	var textEl = new TextChatElement();
    	textEl.initialize(this.connection.channel);
    	this.shadowRoot.querySelector('#textDiv').appendChild(textEl);
        if(attempt==='create'){
            textEl.initiate();
        }else{
            textEl.join();
        }
    },
    
    addMap: function(attempt){
    	var mapEl = new MapElement();
    	mapEl.initialize(this.connection.channel);
    	this.shadowRoot.querySelector('#mapDiv').appendChild(mapEl);
        if(attempt==='create'){
            mapEl.initiate();
        }else{
            mapEl.join();
        }
    },
    
    removeVideo: function(){
    	var vidEl = this.shadowRoot.querySelector('#videoDiv').querySelector("videochat-element");
    	vidEl.end();
    	this.shadowRoot.querySelector('#videoDiv').removeChild(vidEl);
    },
    
    removeText: function(){
    	var textEl = this.shadowRoot.querySelector('#textDiv').querySelector("textchat-element");
    	textEl.end();
    	this.shadowRoot.querySelector('#textDiv').removeChild(textEl);
    }
  
     
  });
  </script>
</polymer-element>
