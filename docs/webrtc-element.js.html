<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: webrtc-element.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: webrtc-element.js</h1>

    


    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/** 
 * @author Andy Andrea (andycandrea)
 * @author Jang Hee I (jhi0417)
 * @author J. Zach Jones (jzjones)
 * @author S. Tyler Smith (s-tyler-smith)
 */

/**
 * @module webrtc-element
 */

Polymer('webrtc-element', {
	/**
	 * @lends module:webrtc-element
	 */

	/** 
	 * The Polymer constructor.
	 * Creates connection for an instance of webrtc-element.
	 * @alias webrtc
	 * @memberOf module:webrtc-element
	 */
	ready: function(){
        this.connection = new RTCMultiConnection();
        this.connection.session = {audio: false, video: false, screen: false, data: false};
    },

	/**
	 * Set the connection's channel and session
	 * @param {string} channelID The ID of the given channel
	 * @param {session} sessionObj The object containing boolean values describing the session
	 * @memberOf module:webrtc-element
	 */
	 
	initialize: function(channelID, sessionObj){
    	this.connection.channel = channelID;
    	this.connection.session = sessionObj;
    },
	
	/**
	 * Communicate with Firebase to find the target room
	 * @memberOf module:webrtc-element
	 */
	findRoom: function(){
        var channels = {};
        var firebaseUrl='https://easpr.firebaseio.com/';
        this.firebase = new Firebase(firebaseUrl+this.connection.sessionid);
        var conObj=this.connection;

        this.firebase.on('child_added', function(snap) {
            var data = snap.val();
            
            if(data.sender == conObj.userid) return;
            
            if (channels[data.channel]) {
                channels[data.channel](data.message);
            };
            
            snap.ref().remove();
        });

        var firebase=this.firebase;
        // overriding "openSignalingChannel" method
        this.connection.openSignalingChannel = function (config) {
            var channel = config.channel || this.channel;
            channels[channel] = config.onmessage;

            if (config.onopen) {
            	setTimeout(config.onopen, 1000);
            }

            return {

                send: function (message) {
                    firebase.push({
                        sender: conObj.userid,
                        channel: channel,
                        message: message
                    });
                },
                channel: channel
            };
        };

        this.firebase.once('value', function (data) {
	        var isRoomPresent = data.val() != null;
	        if (!isRoomPresent) {
	        	conObj.open(conObj.sessionid);
	        }
	        else {
	        	conObj.join(conObj.sessionid);
	        }
	
	        console.debug('room is present?', isRoomPresent);
        });

    },

	/**
	 * Set the ID of the session
	 * @param {string} sessionID The ID value of the session
	 * @memberOf module:webrtc-element
	 */
	setSessionId: function(sessionId){
    	this.connection.sessionid = sessionId;
    },

	/**
	 * Set the type of session (i.e. if the session contains video, audio, screensharing or data transfer)
	 * @param {session} session The session object representing the given session data
	 * @memberOf module:webrtc-element
	 */
	setSessionType: function(session){
    	this.connection.session = session;
    },
	
	/**
	 * Leave the current connection
	 * @memberOf module:webrtc-element
	 */
	end: function(){
        this.connection.leave();
    }
});</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Modules</h3><ul><li><a href="module-map-element.html">map-element</a></li><li><a href="module-textchat-element.html">textchat-element</a></li><li><a href="module-videochat-element.html">videochat-element</a></li><li><a href="module-webrtc-container.html">webrtc-container</a></li><li><a href="module-webrtc-element.html">webrtc-element</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-dev</a> on Fri May 02 2014 22:04:07 GMT-0400 (EDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
