<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: map-element.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: map-element.js</h1>

    


    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/** 
 * @author Andy Andrea (andycandrea)
 * @author Jang Hee I (jhi0417)
 * @author J. Zach Jones (jzjones)
 * @author S. Tyler Smith (s-tyler-smith)
 */

/**
 * @module map-element
 * @extends webrtc-element
 */

Polymer('map-element',{
  /**
   * @lends module:map-element
   */

  /** 
   * The Polymer constructor.
   * Calls the superclass (webrtc-element) constructor.
   * @alias map-element
   * @memberOf module:map-element
   */
  
  ready: function(){
    this.super();
  },

  /** 
   * Sets up channel and grabs map tiles
   * @memberOf module:map-element
   * @param {string} channelID The ID of the corresponding channel.
   */

  initialize: function(channelID){
    this.super([channelID, {data:true}]);
    this.connection.sessionid = ("map_" + this.connection.channel);
    var mapEl = this.shadowRoot.querySelector("#map");
    
    var myIcon = L.icon({
	    iconUrl: 'libs/images/marker-icon.png',
	    iconRetinaUrl: 'libs/images/marker-icon-2x.png',
	    iconSize: [25, 41],
	    iconAnchor: [25, 41],
	    popupAnchor: [-3, -76],
	    shadowUrl: 'libs/images/marker-shadow.png',
	    shadowRetinaUrl: 'libs/images/marker-shadow.png',
	    shadowSize: [41, 41],
	    shadowAnchor: [25, 41]
  	});

    var map = L.map(mapEl).setView([51.505, -0.09], 13);
    var markerLayer = L.layerGroup([]);
    this.mLayer = markerLayer;
    markerLayer.addTo(map);
  
    this.isMapUpdated = true;
  
    //var TILE_LOCATION = 'http://{s}.tile.cloudmade.com/795f9e9d19094307867649e8d21d3f46/997/256/{z}/{x}/{y}.png';
    var TILE_LOCATION = 'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
    L.tileLayer(TILE_LOCATION, {
      maxZoom: 17,
      attribution: 'Map data &amp;copy; &lt;a href="http://openstreetmap.org">OpenStreetMap&lt;/a> contributors, &lt;a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA&lt;/a>, Imagery Â© &lt;a href="http://cloudmade.com">CloudMade&lt;/a>'
    }).addTo(map);
  
    var con = this.connection;

    function onMapClick(e) {
      markerLayer.addLayer(L.marker(e.latlng, {icon:myIcon, draggable:'false'}))
	    //var jsonMarker = JSON.stringify({"type":"marker", "latlng": e.latlng});
	    con.send({"type":"marker", "latlng": e.latlng});
	    console.log(con);
    }

    map.on('click', onMapClick);

    this.connection.onmessage = function(e){
	    console.log("message received");
      if (e.data.type === "marker"){
  		  markerLayer.addLayer(L.marker(e.data.latlng, {icon:myIcon, draggable:'false'}));
      }
      else if (e.data.type === "mapRequest"){
        con.send({type: "markerLayer", markers: markerLayer});
      }
      else if (e.data.type === "markerLayer" &amp;&amp; !this.isMapUpdated){
        markerLayer = e.data.markers;
        this.isMapUpdated = true;
      }
    };
  }
});</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Modules</h3><ul><li><a href="module-map-element.html">map-element</a></li><li><a href="module-textchat-element.html">textchat-element</a></li><li><a href="module-videochat-element.html">videochat-element</a></li><li><a href="module-webrtc-container.html">webrtc-container</a></li><li><a href="module-webrtc-element.html">webrtc-element</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-dev</a> on Fri May 02 2014 22:04:07 GMT-0400 (EDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
