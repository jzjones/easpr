<link rel="import" href="../bower_components/polymer/polymer.html">
<script src="../libs/firebase.js"></script>

<polymer-element name="session-watcher" attributes="sessionName" constructor='SessionWatcher'>
  <template>
  	<div>
  	<span>{{sessionName}}</span><span>{{participants}}</span>
  	</div>
  </template>

  <script>
  Polymer('session-watcher',{
       
    ready: function(){
		console.log(this.sessionName);
		this.participants = "0";
    	var firebaseUrl='https://easpr.firebaseio.com/';
    	var textPrepend='text_';
    	var path=textPrepend+this.sessionName;
    	console.log(path);
        this.firebase = new Firebase(firebaseUrl);
        var thisObj = this;
        this.firebase.child(path).once('value',function(snapshot){
        	var exists=(snapshot.val()!==null);
        	if(exists){
        		var max = 0;
        		for (var key in snapshot.val()){
        			if(snapshot.val().hasOwnProperty(key)){
        				if(snapshot.val()[key].active > max){
        					max = snapshot.val()[key].active;
        				}
        			}
        		}
        		
        		thisObj.participants = max + 1;
        	}else{
        		this.participants = "0";
        	}
        });
    }
     
  });
  </script>
</polymer-element>
